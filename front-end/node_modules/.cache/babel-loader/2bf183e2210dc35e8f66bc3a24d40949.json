{"remainingRequest":"D:\\Death in TJU\\Junior_2nd\\专项综合\\Project\\front-end\\node_modules\\babel-loader\\lib\\index.js!D:\\Death in TJU\\Junior_2nd\\专项综合\\Project\\front-end\\src\\store\\modules\\user.js","dependencies":[{"path":"D:\\Death in TJU\\Junior_2nd\\专项综合\\Project\\front-end\\src\\store\\modules\\user.js","mtime":1591092470709},{"path":"D:\\Death in TJU\\Junior_2nd\\专项综合\\Project\\front-end\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\Death in TJU\\Junior_2nd\\专项综合\\Project\\front-end\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import _Promise from \"D:\\\\Death in TJU\\\\Junior_2nd\\\\\\u4E13\\u9879\\u7EFC\\u5408\\\\Project\\\\front-end\\\\node_modules\\\\@babel\\\\runtime-corejs2/core-js/promise\";\nimport \"core-js/modules/es6.function.name\";\nimport Vue from 'vue';\nimport { login, getInfo, logout } from '@/api/login';\nimport { ACCESS_TOKEN } from '@/store/mutation-types';\nimport { welcome } from '@/utils/util';\nimport { getTeacher } from \"@/api/teacher\";\nexport var notiSource = null;\nvar user = {\n  state: {\n    token: '',\n    name: '',\n    welcome: '',\n    avatar: '',\n    roles: [],\n    info: {}\n  },\n  mutations: {\n    SET_TOKEN: function SET_TOKEN(state, token) {\n      state.token = token;\n    },\n    SET_NAME: function SET_NAME(state, _ref) {\n      var name = _ref.name,\n          welcome = _ref.welcome;\n      state.name = name;\n      state.welcome = welcome;\n    },\n    SET_AVATAR: function SET_AVATAR(state, avatar) {\n      state.avatar = avatar;\n    },\n    SET_ROLES: function SET_ROLES(state, roles) {\n      state.roles = roles;\n    },\n    SET_INFO: function SET_INFO(state, info) {\n      state.info = info;\n    }\n  },\n  actions: {\n    // 登录\n    Login: function Login(_ref2, userInfo) {\n      var commit = _ref2.commit;\n      console.log(\"userInfo \", userInfo);\n      return new _Promise(function (resolve, reject) {\n        login(userInfo).then(function (response) {\n          console.log(response);\n          var result = response.Data;\n          Vue.ls.set(ACCESS_TOKEN, result.id, 7 * 24 * 60 * 60 * 1000);\n          commit('SET_TOKEN', result.id);\n          commit('SET_INFO', result);\n          console.log(\"if=fsrdgfgh\");\n        }).then(function () {\n          resolve();\n        }).catch(function (error) {\n          reject(error);\n        });\n      });\n    },\n    // 获取用户信息\n    GetInfo: function GetInfo(_ref3) {\n      var _this = this;\n\n      var commit = _ref3.commit;\n      return new _Promise(function (resolve, reject) {\n        console.log(\"return back\");\n        getInfo({\n          id: 1750000\n        }).then(function (response) {\n          console.log(response.data);\n          var result = response.data;\n          console.log(\"getInfo\");\n          console.log(_this.result);\n\n          if (result.role && result.role.permissions.length > 0) {\n            var role = result.role;\n            role.permissions = result.role.permissions;\n            role.permissions.map(function (per) {\n              if (per.actionEntitySet != null && per.actionEntitySet.length > 0) {\n                var action = per.actionEntitySet.map(function (action) {\n                  return action.action;\n                });\n                per.actionList = action;\n              }\n            });\n            role.permissionList = role.permissions.map(function (permission) {\n              return permission.permissionId;\n            });\n            commit('SET_ROLES', result.role);\n          } else {\n            reject(new Error('getInfo: roles must be a non-null array !'));\n          }\n\n          commit('SET_NAME', {\n            name: result.name,\n            welcome: welcome()\n          });\n          commit('SET_AVATAR', result.avatar);\n          resolve(response);\n        }).catch(function (error) {\n          reject(error);\n        });\n      });\n    },\n    // 登出\n    Logout: function Logout(_ref4) {\n      var commit = _ref4.commit,\n          state = _ref4.state;\n      return new _Promise(function (resolve) {\n        commit('SET_TOKEN', '');\n        commit('SET_ROLES', []);\n        Vue.ls.remove(ACCESS_TOKEN);\n        logout(state.token).then(function () {\n          resolve();\n        }).catch(function () {\n          resolve();\n        });\n      });\n    }\n  }\n};\nexport default user;",{"version":3,"sources":["D:\\Death in TJU\\Junior_2nd\\专项综合\\Project\\front-end\\src\\store\\modules\\user.js"],"names":["Vue","login","getInfo","logout","ACCESS_TOKEN","welcome","getTeacher","notiSource","user","state","token","name","avatar","roles","info","mutations","SET_TOKEN","SET_NAME","SET_AVATAR","SET_ROLES","SET_INFO","actions","Login","userInfo","commit","console","log","resolve","reject","then","response","result","Data","ls","set","id","catch","error","GetInfo","data","role","permissions","length","map","per","actionEntitySet","action","actionList","permissionList","permission","permissionId","Error","Logout","remove"],"mappings":"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","sourcesContent":["import Vue from 'vue'\r\nimport { login, getInfo, logout } from '@/api/login'\r\nimport { ACCESS_TOKEN } from '@/store/mutation-types'\r\nimport { welcome } from '@/utils/util'\r\nimport {getTeacher} from \"@/api/teacher\";\r\n\r\nexport var notiSource = null\r\n\r\nconst user = {\r\n  state: {\r\n    token: '',\r\n    name: '',\r\n    welcome: '',\r\n    avatar: '',\r\n    roles: [],\r\n    info: {}\r\n  },\r\n\r\n  mutations: {\r\n    SET_TOKEN: (state, token) => {\r\n      state.token = token\r\n    },\r\n    SET_NAME: (state, { name, welcome }) => {\r\n      state.name = name\r\n      state.welcome = welcome\r\n    },\r\n    SET_AVATAR: (state, avatar) => {\r\n      state.avatar = avatar\r\n    },\r\n    SET_ROLES: (state, roles) => {\r\n      state.roles = roles\r\n    },\r\n    SET_INFO: (state, info) => {\r\n      state.info = info\r\n    }\r\n  },\r\n\r\n  actions: {\r\n    // 登录\r\n    Login({ commit }, userInfo) {\r\n      console.log(\"userInfo \", userInfo)\r\n      return new Promise((resolve, reject) => {\r\n        login(userInfo)\r\n          .then(response => {\r\n            console.log(response)\r\n            const result = response.Data\r\n            Vue.ls.set(ACCESS_TOKEN, result.id, 7 * 24 * 60 * 60 * 1000)\r\n            commit('SET_TOKEN', result.id)\r\n            commit('SET_INFO',result)\r\n            console.log(\"if=fsrdgfgh\")\r\n          })\r\n          .then(() => {\r\n            resolve()\r\n          })\r\n          .catch(error => {\r\n            reject(error)\r\n          })\r\n      })\r\n    },\r\n\r\n    // 获取用户信息\r\n    GetInfo({ commit }) {\r\n\r\n      return new Promise((resolve, reject) => {\r\n        console.log(\"return back\")\r\n        getInfo({id:1750000}).then(response => {\r\n          console.log(response.data);\r\n          const result = response.data\r\n          console.log(\"getInfo\")\r\n          console.log(this.result)\r\n          if (result.role && result.role.permissions.length > 0) {\r\n            const role = result.role\r\n            role.permissions = result.role.permissions\r\n            role.permissions.map(per => {\r\n              if (per.actionEntitySet != null && per.actionEntitySet.length > 0) {\r\n                const action = per.actionEntitySet.map(action => { return action.action })\r\n                per.actionList = action\r\n              }\r\n            })\r\n            role.permissionList = role.permissions.map(permission => { return permission.permissionId })\r\n            commit('SET_ROLES', result.role)\r\n          } else {\r\n            reject(new Error('getInfo: roles must be a non-null array !'))\r\n          }\r\n\r\n          commit('SET_NAME', { name: result.name, welcome: welcome() })\r\n          commit('SET_AVATAR', result.avatar)\r\n\r\n          resolve(response)\r\n        }).catch(error => {\r\n          reject(error)\r\n        })\r\n      })\r\n    },\r\n\r\n    // 登出\r\n    Logout({ commit, state }) {\r\n      return new Promise((resolve) => {\r\n        commit('SET_TOKEN', '')\r\n        commit('SET_ROLES', [])\r\n        Vue.ls.remove(ACCESS_TOKEN)\r\n\r\n        logout(state.token).then(() => {\r\n          resolve()\r\n        }).catch(() => {\r\n          resolve()\r\n        })\r\n      })\r\n    }\r\n\r\n  }\r\n}\r\n\r\nexport default user\r\n"]}]}